# Prometheus alert rules for A2AX Protocol pilot
# Add to your Prometheus config: rule_files: [ "infra/prometheus-alerts.yml" ]

groups:
  - name: a2ax_pilot
    rules:
      - alert: AgentIdentityDown
        expr: up{job="a2ax-api"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "Agent Identity API is down"

      - alert: AgentIdentityHighVerifyErrors
        expr: |
          sum(rate(agent_identity_verify_total{result="failure"}[5m])) /
          sum(rate(agent_identity_verify_total[5m])) > 0.05
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Verify error rate > 5%"

      - alert: AgentIdentityReplaySpike
        expr: rate(agent_identity_replay_denials_total[1m]) > 10
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "Replay denials > 10/min - possible attack"

      - alert: AgentIdentityVerifyLatencyHigh
        expr: histogram_quantile(0.99, rate(agent_identity_verify_duration_seconds_bucket[5m])) > 2
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Verify p99 latency > 2s"

      - alert: AgentIdentityRateLimitSpike
        expr: sum(rate(agent_identity_rate_limit_hits_total[5m])) > 100
        for: 5m
        labels:
          severity: info
        annotations:
          summary: "Rate limit hits > 100/min - consider tuning"
